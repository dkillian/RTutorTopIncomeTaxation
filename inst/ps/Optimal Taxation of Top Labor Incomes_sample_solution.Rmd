# Problem Set Optimal Taxation of Top Labor Incomes

  
```{r include=FALSE}

ps.dir =  'D:/libraries/RTutor/examples' # set to the folder in which this file is stored
ps.file = 'Optimal Taxation of Top Labor Incomes_sample_solution.Rmd' # set to the name of this file
user.name = 'Jane Doe' # set to your user name

library(RTutor)
check.problem.set('Optimal Taxation of Top Labor Incomes', ps.dir, ps.file, user.name=user.name, reset=FALSE)

# To check your solution in RStudio save (Ctrl-S) and then run all chunks (Ctrl-Alt-R)
```
Name: `r user.name`


Author:  Jonas Send   


In their paper **"Optimal Taxation of Top Labor Incomes: A Tale of Three Elasticities"** Thomas Piketty, Emmanuel Saez and Stefanie Stantcheva (2014) analyse the response of top earners to taxes and derive optimal tax rate formulas from their findings. In this interactive offline *R* Tutorial, we are going to gradually reproduce their study and discuss it.  
(The article and the corresponding public data is provided on the website of the *American Economic Association*. You can click on this [link](https://www.aeaweb.org/articles.php?doi=10.1257/pol.6.1.230) to download it.)

### Introduction

The main focus of the paper is to examine the channels through which top earners react to changes in top net-of-tax rates. Top net-of-tax rate is defined as $1 - r$, with $r$ being the top marginal tax rate on ordinary income. As often in economics, when we look at the response of people to external influences, we are going to talk about elasticities. In our case, we are going to look at three different elasticities:

* $e_1$ describes the **supply-side response** of top earners to raises of the top net-of-tax rate ("How much does real income of the top 1 percent increase in percent if the top net-of-tax rate increases by one percent?")

* $e_2$ describes **tax-avoidance responses** (changes in reported income with no influence on the real income due to changes of the top net-of-tax rate)

* $e_3$ describes **compensation-bargaining responses** (changes in taxable income due to a different level of influence top earners wield on compensation committees as a response to changes in the top net-of-tax rate)

These three elasticities combine to the overall elasticity $e$ of the taxable income. $e$ describes how much taxable top 1 percent income increases  if the top net-of-tax rate rises. 

For example, if the top net-of-tax rate $1 - r$ increases by $1\%$ (due to a decrease of the top marginal tax rate $r$) and the top 1 percent income increases by $0.7\%$, $e$ can be calculated as:

$$e~=~\dfrac{\dfrac{\Delta~top~1~percent~income}{top~1~percent~income}}{\dfrac{\Delta~(1-r)}{(1-r)}}~=~\dfrac{0.7\%}{1\%}~=~0.7~.$$

Note: It is important to know the influence of the single elasticities on the overall elasticity in order to design an optimal top tax rate. For example, if the only important elasticity is $e_3$, tax rates should be close to 100% as bargaining effects only come at the expense of other income classes.

**This problem set has the following structure:**

* **Exercise 1 US evidence**  
In this chapter we take a look at empirical evidence from the US that gives us an understanding of how top tax rates and top income shares and totals are connected. This will also help us to get a first idea of the magnitude of the different mentioned elasticities. While doing so, we will learn about different tools in *R* that help us to analyse data.

* **Exercise 2 International evidence**  
Here we analyse data from various OECD countries to gather further insights into top income elasticities and optimal top tax rates. This will help us to tackle some problems that arise in *Exercise 1* and to support our findings. We will also deepen our *R* skills and look at other smart solutions for common data issues.

* **Exercise 3 Theory**  
In this exercise we consider the theoretical model that Piketty et al. develop in their paper and use it to derive a R function that will help us to calculate possible optimal top tax rates.

* **Exercise 4 Scenario Analysis**  
This exercise gives us the opportunity to look at different possible scenarios that describe top income responses and to deduce corresponding optimal top tax rates using the function that we developed in *Exercise 3*.

* **Exercise 5 Conclusion**  
This final exercise gives us the opportunity to sum up our analysis and discuss possible tax policy implications.

*Note that this is the recommended order for this problem set. It is possible to skip exercises or to start with the theory exercise before working on the evidence based exercises. However, if you are new to 'R', bear in mind that 'Exercise 2' builds on the skills acquired in 'Exercise 1'. Additionally, you have to complete 'Exercise 3.2' to be able to work on 'Exercise 4'*

## Exercise 1.1 US evidence - Graphical approach

In this exercise we are going to analyse macroeconomic data from the US for the past century by creating plots that give us a first idea of the relationship between top 1 percent income and top marginal tax rates.

### a) Loading the required data

In order to be able to translate the data into some expressive graphics, we have to load the data into our work space. In the directory of your problem set, you should have saved the file *usdata.csv*. Use the command `read.table()` to load the data and assign it to a variable called `US.data`. Type your code into the open window below. To continue, click the *check*-button to find out whether your solution is correct. If you need help, click the *hint*-button to get some clues on how to solve the problem. If you want more information on the `read.table()`-command you can click the *info*-button below.

info("read.table()") # Run this line (Strg-Enter) to show info

```{r "1_1_a"}
US.data = read.table("usdata.csv")
```

The data set contains different macroeconomic values for the years 1913 to 2008 such as nominal GDP, marginal tax rates for top incomes and income shares of the top 1 percent for the United States of America. If you want to take a look at the data that you just loaded, click on the button *data* you can find above. If you are interested in more detailed information of the variables we are going to work with now, see the *info* section below.

info("Variables of interest 1") # Run this line (Strg-Enter) to show info
  
### b) Plotting the data

First, we are going to try to get a graphical view of the data at hand. For that, we use the package *ggplot2* which gives us a very nice array of tools to create graphs. 
Here is an example of how to use the function `ggplot()` from the aforementioned package to plot the variable `topmtr` over time. Just click the *check* button to see the plot:

```{r "1_1_b_example_1"}
# load the required package 'ggplot2' from the library:
library(ggplot2)

# With 'ggplot(US.data)' we select the data that ggplot is going to use when
# looking for variables. 'geom_line(aes(year, topmtr))' adds a line which
# describes the variable 'top1perc' in dependency of the variable 'year' to
# the ggplot object. The other arguments which have to be seperated with
# commas are pretty self-explanatory; 'size = 1' leads to a thicker line.
p1 = ggplot(US.data) + geom_line(aes(year, topmtr), colour = "red", 
                                 linetype = "dashed", size = 1)

# show the plot:
p1
```

This plot illustrates how the top marginal tax rate on ordinary income in the US has changed during the last century.

info("Introduction to ggplot2") # Run this line (Strg-Enter) to show info

Now try to plot the variable `top1perc` in dependency of the variable `year` with `ggplot`. Use `geom_line()` as in the example above and save your object as `p2`. Because now we only want to have a black line you can leave out the arguments `colour`, `linetype` and `size`. Don't forget to show your plot.

```{r "1_1_b_1"}
p2 = ggplot(US.data) + geom_line(aes(year, top1perc))
p2
```

This plot shows how the share of overall income of the top 1 percent in the US has changed between 1913 and 2008. We are going to discuss the variable's behaviour later in more detail.

You can add new geometrical objects (geoms) to your plot as shown in the following example where a dotted red line that depicts the development of the top marginal tax rate on realized long-term capital gains over time is added to `p1`:

```{r "1_1_b_example_2"}
p1 = p1 + geom_line(aes(year, topmtr_k), colour = "red", linetype = "dotted",
                    size = 1)
# You can add any number of geoms to a ggplot object.

p1
```

Now try to do the same and add a line which depicts the variable `top1perc_nok`, the top 1 percent income share excluding capital gains, to `p2`. As colour, use the hexadecimal code "#0000FF" which stands for the colour blue. Afterwards, show the plot.

```{r "1_1_b_2"}
p2 = p2 + geom_line(aes(year, top1perc_nok), colour = "#0000FF")
p2
```

Now we want to look at both plots to get an impression of how the top marginal tax rates influenced the top income shares. That will give us a first chance to discuss implications for the three different elasticities that were mentioned at the beginning. For that reason we are going to use the function `grid.arrange()` from the package *gridExtra*. Take the two plots `p1` and `p2` and arrange them in one plot using the syntax `grid.arrange(plot1, plot2)`.

```{r "1_1_b_3"}
# load the required package from the library:
library(gridExtra)

# Type in your command here:

grid.arrange(p1, p2)
```

In the first plot we can see the top marginal tax rate for ordinary income $r$ as a dashed line and for realized long-term capital gains as a dotted line. The second plot shows the top 1 percent income share including realized capital gains in black and excluding realized capital gains in blue. We can see that there is a clear negative correlation between top 1 percent income share and the top marginal tax rate for ordinary income (top MTR). Especially the rise in income share and drop in top MTR since the 1980s is really significant. If this is due to a causal relationship from top MTR to top income shares, the overall elasticity $e$ is high. Also note that the share of top income that is accounted for by capital gains (the difference between the black and the blue curve) doesn't seem to be correlated to the partly immense difference between top tax rates for normal income and top tax rates for long-term capital gains. According to Piketty et al., as capital gains are the main channel for tax avoidance, this indicates that tax avoidance response $e_2$ makes up only a small amount of $e$. 

While we already could get a vague idea of the dimensions of overall elasticity $e$ and tax avoidance response $e_2$ in the US, we cannot yet make a first statement about the influence of supply-side elasticity $e_1$ and compensation-bargaining elasticity $e_3$. Therefore, we are now going to plot real cash market income growth per adult of both top 1 percent incomes and bottom 99 percent incomes over time. These two values are saved in the variables `incadulttop1_n` and `incadultbot99_n`. And again, we are going to compare this plot with the top marginal tax rates. 

Now you have to use everything that we worked on so far. First, create a ggplot-object `p3` in which you plot `incadulttop1_n` in dependency of the variable `year` as a line. Use the colour "blue". Then, add a line which depicts `incadultbot99_n` over time in the colour "purple" to `p3`. At last, plot `p1` together with `p3`, using the command `grid.arrange()`. If you need help, feel free to use the *hint*-button.

info("Variables of interest 2") # Run this line (Strg-Enter) to show info

```{r "1_1_b_4"}
p3 = ggplot(US.data) + geom_line(aes(year, incadulttop1_n), colour = "blue")
p3 = p3 + geom_line(aes(year, incadultbot99_n), colour = "purple")
grid.arrange(p1, p3)
```

We can see that income growth for the bottom 99 percent (purple) was highest between the beginning of the 1930s and the beginning of the 1970s, exactly the period during the last century when net-of-tax rates for the top 1 percent were low (due to a high top MTR). The growth for bottom 99 percent incomes has slowed down since about 1973, while top 1 percent incomes started to grow fast since the 1970s. This hints at the fact that the growth in top incomes might have come to the expense of bottom incomes which would translate into a high bargaining response of the top 1 percent and therefore into a high $e_3$.

By means of plotting our data, we could already draw first conservative conclusions about correlations between top net-of-tax rates and top 1 percent incomes. We also were able to get a first idea of the influence the three different elasticities have on the overall elasticity. But while it is nice to have plots of data to get a first impression, one should never draw final conclusions about causal relationships between different factors just by looking at graphs. That is why, in the next two exercises, we are going to do some quantitative and statistical analysis of our data. To move to *Exercise 1.2* you can click on the *Go to next exercise...*-button in the bottom left as a shortcut.

info("Correlation does not imply causation!") # Run this line (Strg-Enter) to show info

*You can find the corresponding graphics and the associated discussions on pages 16f., 20 and 22 of the paper.*

## Exercise 1.2 US evidence - Simple estimations

In this exercise, we want to get a simple, quantitative estimate of the overall elasticity $e$ for the period from 1960 to 2008, the last year of our data. 

### a) Preparing the data

To do that, we need the average of the first five years (1960-1964) and of the last five years (2004-2008) of our variables `topmtr`, `top1perc` and `top1perc_nok`. 

Here is an example of how to use the function `filter()` from the package *dplyr* to isolate the data from the years 1960 to 1964. Click the *edit*-button to activate the code chunk and then proceed using the *check* button, as usual.

info("filter() and dplyr") # Run this line (Strg-Enter) to show info

```{r "1_2_a_example_1"}
# first, we load our data again
US.data = read.table("usdata.csv")

# second, we load the required package from the library:
library(dplyr)

# then, we can apply the 'filter()'-function to our data frame:
filter(US.data, year >= 1960 & year <= 1964)
```

You can see that the `filter()`-command provided us with a new data frame that contains only the rows for the years 1960-1964. We can now access the columns that we want to analyse by using the syntax `data.frame$column.name`. Then we can calculate the average of the required variable by using the command `mean()`. In the next example, you can see how to combine these three functions to receive the aforementioned averages for the variable `topmtr`.

```{r "1_2_a_example_2"}
topmtr_start = mean(filter(US.data, year >= 1960 & year <= 1964)$topmtr)
topmtr_end = mean(filter(US.data, year >= 2004)$topmtr)

# To get an idea of the variables that we calculated, we show them:
topmtr_start
topmtr_end
```

In this chunk we created two new variables. `topmtr_start` is the average of the top marginal tax rate in the US for the years 1960-1964. `topmtr_end` is the same for the years 2004-2008.

Use the same commands and syntax to compute the average of `top1perc_nok` for the years 1960-1964 as `top1_start_n` and for the years 2004-2008 as `top1_end_n`. Then do the same for the variable `top1perc` and safe the results as `top1_start_k` and `top1_end_k`, respectively. 

```{r "1_2_a_1"}
# assign the averages of 'top1perc_nok' for 1960-1964 to 'top1_start_n' and
# for 2004-2008 to 'top1_end_n'


# assign the averages of 'top1perc' for 1960-1964 to 'top1_start_k' and for
# 2004-2008 to 'top1_end_k'


top1_start_n = mean(filter(US.data, year >= 1960 & year <= 1964)$top1perc_nok)
top1_end_n = mean(filter(US.data, year >= 2004)$top1perc_nok)
top1_start_k = mean(filter(US.data, year >= 1960 & year <= 1964)$top1perc)
top1_end_k = mean(filter(US.data, year >= 2004)$top1perc)
```

### b) A first comparison

We now arrange the computed variables in the data frame `Comparison.data` and show it using the command `grid.table()` from the *gridExtra* package (the package that we have already utilized to arrange different plots):

```{r "1_2_b_example_1"}
# This code chunk creates a new data frame 'Comparison.data' which contains
# three columns for the three different variables that we just summarized and
# two rows for the two periods. Note that 'row.names = c(...)' can be used to
# manually name the rows of your data frame and that 'c(a,b,c)' creates an
# array containing the values 'a', 'b' and 'c'.
Comparison.data = data.frame("top_mtr" = c(topmtr_start, topmtr_end), 
                             "top1_n" = c(top1_start_n, top1_end_n), 
                             "top1_k" = c(top1_start_k, top1_end_k), 
                             row.names = c("1960-1964", "2004-2008"))

# 'round(data, digits = x)' rounds all the values in the data frame 'data' to
# x digits after the comma. 'grid.table(data)' shows the data frame 'data' as
# a table.
grid.table(round(Comparison.data, digits=3))
```

We see that the top marginal tax rate `top_mtr` dropped drastically from $85\%$ in the beginning of the 1960s to $35\%$ at the end of the last decade. During the same period, top 1 percent income shares excluding capital gains `top1_n` more than doubled from $8.2\%$ to $17.7\%$ and top 1 percent income shares including capital gains `top1_k` also increased strongly from $10.2\%$ to $21.8\%$. As did the plots we generated in *Exercise 1.1*, these numbers also indicate a strong negative correlation between top marginal tax rates and top incomes. We can use these numbers to calculate a first, very simple estimate for our overall elasticity $e$ of top incomes.

### c) Estimation

We are going to estimate $e$ using the formula

$$\dfrac{log(top~1~percent~income~end)~-~log(top~1~percent~income~start)}{log(1-top~MTR~end)~-~log(1-top~MTR~start)}.$$ 

Try to use this formula to calculate the estimated overall elasticity for the top 1 percent income share excluding capital gains as `e_estimate_n` and including capital gains as `e_estimate_k`. Note: the command to compute the natural logarithm is `log()`. Also, don't forget to use all the required brackets. If you happen to have problems solving this one, using the *hint*-button would be a very good idea. You might want to scroll up a little to remember the names of the variables that we created in the first two exercises that you have to use here.

info("Why do we use 'log()' and '(1 - top MTR)'?") # Run this line (Strg-Enter) to show info

```{r "1_2_c_1"}
# assign e_estimate_n

# assign e_stimate_k

# show e_estimate_n

# show e_stimate_k

e_estimate_n = (log(top1_end_n) - log(top1_start_n)) /
               (log(1 - topmtr_end) - log(1 - topmtr_start))
e_estimate_k = (log(top1_end_k) - log(top1_start_k)) /
               (log(1 - topmtr_end) - log(1 - topmtr_start))
e_estimate_n
e_estimate_k
```

For both income including and income excluding capital gains, the estimated elasticity is around $0.52$. This means two things. First, if the rise in income shares is only due to the decrease in the top marginal tax rate, then the real overall elasticity $e$ is high with a little over $0.5$. Second, the two elasticities are almost the same. As capital gains are the main channel for tax avoidance, this implies that $e_2$ is close to zero.

Now it's time for you to answer a first short question. Fill in your answer in place of "???" and remove the comment in the corresponding line.

```{r "1_2_c_2"}
# Question: If the tax-avoidance elasticity component e2 was a substantial
# fraction of the overall elasticity e, would responses for income including
# capital gains be substantially...
# a) ...smaller or
# b) ...bigger
# than for income excluding capital gains? (considering a change in top MTR on
# ordinary income)
#
# answer = "???" # Assign "a" or "b" to 'answer' and remove the comment

answer = "a"
```

You can click on the following *info* box to read an explanation of the answer to this quiz.

info("Tax-avoidance responses") # Run this line (Strg-Enter) to show info

Of course, the number we calculated is a very vague estimate, so in the ensuing exercises, we are going to try to produce some more reliable figures.

*This partial exercise is based on pages 16 and 18 of the paper.*

## Exercise 1.3 US evidence - Linear regressions

### a) Elasticity estimations

Now, we want to to check the assumptions that we have gathered so far with some linear regressions. In contrast to *Exercise 1.2*, we are going to use the whole time series from 1913 to 2008.  
First, we are going to use the following simple linear regression: 

$$log(top~1~percent~income~share)~=~\alpha~+~e~\cdot ~log(1~-~top~MTR)~+~\epsilon$$

(Note: We use logarithmic values in order to obtain elasticity estimates. For further information see the *info* section *Why do we use 'log()' and '(1 - top MTR)'?* in *Exercise 1.2*.)

This example shows you how to fit this regression on top income share excluding capital gains using the command `lm()`:

info("The linear regression model and 'lm()'") # Run this line (Strg-Enter) to show info

```{r "1_3_a_example_1"}
# First, we load our data again:
US.data = read.table("usdata.csv")

# Then, we do our first linear regression:
US.reg1 = lm(log(top1perc_nok) ~ log(1 - topmtr), data = US.data)
```

Try to do the same regression on top income share including capital gains `top1perc` and assign it to the variable `US.reg2`.

```{r "1_3_a_1"}
US.reg2 = lm(log(top1perc) ~ log(1 - topmtr), data = US.data)
```

Now we can look at the two regressions utilizing the command `showreg()` from the package 'regtools':

info("'showreg()' and the package 'regtools'") # Run this line (Strg-Enter) to show info

```{r "1_3_a_example_2"}
# load the required package from the library:
library(regtools)

# We pass 'showreg()' a list with our two regressions and add names to the two
# models using 'custom.model.names':
showreg(list(US.reg1, US.reg2), 
        custom.model.names = c("capital gains excluded",
                               "capital gains included"))
```

We find the estimator for $e$ in our regression in the line *log(1 - topmtr)*. The value in brackets underneath is the calculated standard deviation of our estimator. The stars behind represent the significance level of our estimator. The three stars for *log(1 - topmtr)* in the first column mean that if the true value of $e$ was zero then the probability of estimating a coefficient of $0.25$ or higher would be below $0.1\%$. (The higher the estimate for a coefficient is compared to its standard deviation, the more significant is the influence of the regressor on the regressand.)  
Using this type of regression, we get an elasticity of around $0.25$, again with no significant difference whether we include capital gains or not.

As a next step, we want to include a time trend in our regression in order to test for the influence time has on our estimations. Our regression has now the following form:

$$log(top~1~percent~income~share)~=~\alpha~+~e~\cdot ~log(1~-~top~MTR)~+~c~\cdot ~time~+~\epsilon$$

info("Controlling for a variable") # Run this line (Strg-Enter) to show info

To implement this regression, you can copy the code we used to get `US.reg1` and `US.reg2`. Then add the variable `year` to the regressors using the concatenator `+`. Safe these new time-trend-including regressions as `US.reg3` for the variable `top1perc_nok` and `US.reg4` for the variable `top1perc`. Then use `showreg()` to show the results. Adopt the manual model names from the last example.

```{r "1_3_a_2"}
US.reg3 = lm(log(top1perc_nok) ~ log(1 - topmtr) + year, data = US.data)
US.reg4 = lm(log(top1perc) ~ log(1 - topmtr) + year, data = US.data)
showreg(list(US.reg3, US.reg4), 
        custom.model.names = c("capital gains excluded", 
                               "capital gains included"))
```

Again, we receive a significant positive elasticity with around $0.3$. Again, with no notable difference between the two income shares. Our results therefore are robust to including a time trend. Piketty et al. conclude that this means that there is presumably a strong link between top marginal tax rates and top 1 percent shares and that tax avoidance effects (expressed through $e_2$) tend to be small, just as we expected when looking at the summarizing plots from *Exercise 1.1*. 

info("Further insights") # Run this line (Strg-Enter) to show info
   
### b) Effect of top MTR on income growth

In *Exercise 1.1* we looked at the influence marginal top tax rates have on income growth of the top 1 and bottom 99 percent. We are going to do the same using regressions, again, to check how the different channels of income response contribute to our overall elasticity. Our regressions will only use data excluding capital gains because there is again no significant difference between the two types of income, as is shown in the paper.

Including a time trend, we are going to regress the influence of the top net-of-tax rate `1 - topmtr` on three different income variables in our data set: average real income `incadult_nok`, top 1 percent real income `incadulttop1_nok` and bottom 99 percent real income `incadultbot99_nok`, all excluding capital gains. If you want to get more details on these variables, feel free to use the data explorer.  

Our regression now has the form:

$$log(income)~=~\alpha~+~e~\cdot ~log(1~-~top~MTR)~+~c~\cdot ~time~+~\epsilon$$

The regressions for `incadulttop1_nok` and `incadultbot99_nok` are already given, you only have to assign the regression for `incadult_nok` to the variable `US.reg7`. It's not a big challenge, but the standard `lm()` regression is a powerful tool which you can't practice using enough.

```{r "1_3_b_1"}
US.reg5 = lm(log(incadulttop1_nok) ~ log(1 - topmtr) + year, data = US.data)
US.reg6 = lm(log(incadultbot99_nok) ~ log(1 - topmtr) + year, data = US.data)

# Do the last one for 'incadult_nok':

US.reg7 = lm(log(incadult_nok) ~ log(1 - topmtr) + year, data = US.data)
```

So far, we have only used the standard linear regression which uses the assumption that the variance of the error term is constant (known as homoscedasticity). This might not be true and might simulate significance of results that are not significant. In their paper, for their regressions on the US data Piketty et al. use a more robust version, a Newey-West regression with 8 lags, to be exact. This type of regression is put into use to deal with autocorrelation and heteroskedasticity. To find out more, click the *info*-button below.

info("Newey West") # Run this line (Strg-Enter) to show info

To apply standard errors from Newey West, we utilize the possibility to pass `showreg()` a list of covariance matrices. To get these matrices, we use the function `NeweyWest()` from the *sandwich* package. Take a look at the code in the following example to comprehend it, then click the *check*-button as usual.

info("'NeweyWest()' and the 'sandwich' package") # Run this line (Strg-Enter) to show info

```{r "1_3_b_example"}
# load the required package from the library:
library(sandwich)

# Create a Newey West covariance matrix for each regression model and assign
# them to the list 'cov.list':
cov.list = list(NeweyWest(US.reg5, lag = 8, prewhite = FALSE), 
                NeweyWest(US.reg6, lag = 8, prewhite = FALSE), 
                NeweyWest(US.reg7, lag = 8, prewhite = FALSE))

# Summarize the three models in the list 'reg.list':
reg.list = list(US.reg5, US.reg6, US.reg7)

# Show the three regressions, using the Newey West covariance matrices. Again,
# we use custom model names. 'digits = 3' rounds all values to three digits
# after the comma. 'include.adjrs = FALSE' and 'include.rsquared = FALSE'
# surpress the lines 'R^2' and 'Adj. R^2' for better clarity.
showreg(reg.list , custom.model.names = c("Top 1 percent real income", 
                                          "Bottom 99 percent real income",
                                          "Average real income"),
        digits = 3, vcov.li = cov.list, include.adjrs = FALSE,
        include.rsquared = FALSE)
```

The results confirm our finding from exercise *a)* that top 1 percent income is strongly positively linked to the top net-of-tax rate. $e$ is highly significant. In addition, bottom 99 percent income is significantly (at the 5% level) negatively related to the top net-of-tax rate. Piketty et al. argue that this suggests that increases in top incomes come at the expense of bottom incomes (an effect called "trickle up"), indicating a high $e_3$. Average incomes are not significantly linked to top net-of-tax rates, implying that the supply-side response of top earners to changes in top marginal tax rates $e_1$ makes up only a small portion of the overall response $e$ (if top earners responded to raises in top net-of-tax rates primarily by increasing productivity, then that should have a positive influence on GDP). 

At the end of this exercise, let us do a little quiz. Remember, you just need to replace the "???"s with the right answers.

```{r "1_3_b_2"}
# Question 1: Considering the implications that Piketty et al. detect in their
# analysis so far, which one of the three elasticities seems to be the biggest
# in the US:
# a) e1 (supply-side response),
# b) e2 (tax-avoidance response) or
# c) e3 (compensation-bargaining response) ?
# answer1 = "???" # Assign "a", "b" or "c" to 'answer1' and remove the comment
# 
# Question 2: Look at our last regressions. Is GDP growth likely linked to the
# top marginal tax rate?
# answer2 = "???" # Assign "yes" or "no" to answer2 and remove the comment 
#
# Question 3: Can we be sure yet, that our preliminary conclusions reflect
# reality?
# answer3 = "???" # Assign "yes" or "no" to answer3 and remove the comment 

answer1 = "c"
answer2 = "no"
answer3 = "no"
```

For more information, especially on *question 3* of our little quiz, click the *info*-section below.

info("Reverse causality and external effects") # Run this line (Strg-Enter) to show info

Besides the problems that you can read about in the *info* section above, keep in mind that so far, we only have analysed data from the US. If we want to obtain universal insights into top income elasticities and optimal top tax rates we have to look at further evidence. 

*For the regressions and the associated discussion compare pages 16 and 18-22.*

## Exercise 2.1 International evidence - Top income shares

After we have taken a look at data just from the US in *Exercise 1*, we are next going to analyse international macroeconomic evidence in order to be able to substantiate our findings. We are going to deepen the *R* skills that we have acquired in *Exercise 1* and also consider some more fancy ways to study and visualize data.

### a) Using a Google motion chart

First, we need to upload the new data *intdata.dta* which should also be saved in the directory of your problem set. This time, the data is stored in the *.dta*-format which is used to store data by the statistical software *Stata*. To load a *.dta* file we have to use the command `read.dta()` from the package *foreign*. This command is used with the same syntax as `read.table()`.

info("'read.dta()' and the foreign package") # Run this line (Strg-Enter) to show info

Try to upload the file *intdata.dta* into your work space using the syntax `read.dta("filename")` and assign it to the variable `Int.data`.

```{r "2_1_a_1"}
# First, we have to load the required package
library(foreign)

# Then, upload the data:

Int.data = read.dta("intdata.dta")
```

This data set contains the three macroeconomic values marginal tax rates for top incomes as `mtr`, income shares of the top 1 percent `top1` and real GDP per capita `gdpcap` from 18 different OECD countries for the years 1960 to 2010. For some variables, the data is not complete over the whole time span for some countries. See the *Data Explorer* for more information.

To get a first overview of how top marginal tax rates influenced top 1 percent income shares in the different countries we are going to use a motion plot that is provided by the package *googleVis* that allows you to create a lot of different Google plots. This package is a great tool set to illustrate your data which you should definitely check out. As a start, you can try to comprehend the code in the next example chunk.

info("googleVis") # Run this line (Strg-Enter) to show info

```{r "2_1_a_example", results = 'asis'}
# First, we load the needed package
library(googleVis)

# Then, we create a motion chart using the command 'gvisMotionChart()'. We set 
# 'idvar = "country"' because we are interested in the data for each country
# and 'timevar = "year"' because 'year' is the variable that depicts time in
# our dataset. We use 'xvar = "mtr"' and 'yvar = "top1"' because we want to
# know more about the influence of top MTR on top 1 percent incomes.
# 'colorvar = "top1"' and 'sizevar = "gdpcap"' set default values for our
# plot. In addition, we use our data only until 2005 because after this point
# in time we don't have sufficient information for a couple of countries.
mp = gvisMotionChart(subset(Int.data, year <= 2005), idvar = "country",
                     timevar = "year", xvar = "mtr", yvar = "top1",
                     colorvar = "top1", sizevar = "gdpcap")

# Finally, we simply plot the motion chart
plot(mp, tag = "chart")
```

Each bubble in the graph depicts one country and its relationship between top MTR and top 1 percent income share. If you click the play-button in the bottom left, you can see how that relationship developed over time for the different countries.
You can play around a little bit with the graph. For example, click on different bubbles to see what country they represent or change the variables for *x*, *y*, *color* and *size*.

Now, deploying the motion chart, we want to do a little quiz:

```{r "2_1_a_2"}
# Question 1: If you take a look at the year 1960, can you see a strong
# relation between top MTR and top 1 percent income?
# answer1 = "???" # Assign "yes" or "no" to 'answer1' and remove the comment
#
# Question 2: Take a look at the year 2005. Is there now a strong
# relationship?
# answer2 = "???" # Assign "yes" or "no" to 'answer2' and remove the comment
#
# Question 3: Comparing the development of Japan and Canada between 1960 and
# 2005, which one of the two countries seems to have a higher elasticity of
# top income shares? (Tip: Select the two countries, activate 'Trails' and let
# the chart play through the whole time span.)
# a) Canada
# b) Japan
# answer3 = "???" # Assign "a" or "b" to 'answer3' and remove the comment

answer1 = "no"
answer2 = "yes"
answer3 = "a"
```
  
  
Analyzing the motion chart closely, the following lessons emerge:
* The distribution of top marginal tax rates across OECD countries was very widespread in 1960 (between about 45% and 90%) and has become narrow in 2005 (between about 40% and 60%). At the same time, the dispersion of top income shares has become much broader (the difference between the minimum and maximum of top income share grew from about 5.5 percentage points in 1960 to about 12 percentage points in 2005).
* While during the 1960s and 1970s there is no plain correlation visible between top net-of-tax rates and top 1 percent income share, beginning in the 1980s we can see more and more a very strong positive correlation between these two variables. The situation we can observe in 2005 is consistent with our findings from *Exercise 1*.
* The development across OECD countries is very heterogeneous, implying that the overall elasticity strongly depends on the institutional reality in each country. We will look at some elasticity estimations for individual countries at the end of this partial exercise.

### b) Let's back it up with statistics!

So far, today the relationship between top net-of-tax rate and top income share internationally leads to the same conclusions as the US evidence. Again, we want to support these conclusions we drew using charts with regression analysis. We are going to use the following linear regression including country fixed effects to test the influence of top net-of-tax rates on top 1 percent income shares in our international data:

$$log(top~1~percent~income~share)~=~\alpha~+~e~\cdot ~log(1~-~top~MTR)~+~b~\cdot ~country~+~\epsilon$$

info("Country fixed effects") # Run this line (Strg-Enter) to show info

Implement this regression on our data set `Int.data` using the `lm()` command, just as you did in *Exercise 1.3*. Note that you can add the variable `country` to the regressors the same way as you did with the variable `year`. Top net-of-tax rate can be obtained using `(1 - mtr)`. Save the regression as `Int.reg1`.

```{r "2_1_b_1"}
Int.reg1 = lm(log(top1) ~ log(1 - mtr) + country, data = Int.data)
```

In the motion chart we were able to observe that the strength of the correlation between top net-of-tax rates and top income shares increased over time. That's why we want to do the exact same regression we just did for the two time spans until 1980 and from 1981. To do that, use the `filter()`-command to pass `lm` the correct data and save the regression for the first period as `Int.reg2` and for the second period as `Int.reg3`.

```{r "2_1_b_2"}
Int.reg2 = lm(log(top1) ~ log(1 - mtr) + country,
              data = filter(Int.data, year <= 1980))
Int.reg3 = lm(log(top1) ~ log(1 - mtr) + country,
              data = filter(Int.data, year >= 1981))
```

Let's take a look at the results from our three regressions. Remember how we used Newey West standard errors in *Exercise 1.3*? This time we are going to use another type of standard errors that is very often used to obtain a robust regression by utilizing a standard function of the `showreg()` command.

info("Using standard robust errors with 'showreg()' - HC1 as an example") # Run this line (Strg-Enter) to show info

```{r "2_1_b_example"}
# We set 'robust = TRUE' and 'robust.type = "HC1"' to obtain robust standard
# errors. Further, we use 'omit.coef = "country"' to leave out all 18 lines
# with the word 'country'.
showreg(list(Int.reg1, Int.reg2, Int.reg3), 
        custom.model.names = c("1960-2010", "1960-1980", "1981-2010"), 
        digits = 3, robust = TRUE, robust.type = "HC1", omit.coef = "country")
```

We notice that the estimated elasticity was very low and insignificant during the first period from 1960 to 1980 and very high at around $0.6$ in the period from 1981 to 2010. This suggests different behavioural responses due to institutional changes, as do the differences between countries. If you look at the whole period from 1960 to 2010 you obtain an estimated elasticity of about $0.3$. For both the whole time span and the later phase, elasticities are highly significant.

This means, that for the past decades our international evidence is consistent with our US evidence. This strongly implies that there is in fact a strong positive correlation between top net-of-tax rates and top 1 percent income shares. Hence, the overall elasticity $e$ can be, especially for the recent past, estimated at a high level of about $0.5$, as Piketty et al. do in their paper.

info("Differences between countries") # Run this line (Strg-Enter) to show info

*This partial exercise is based on pages 3 and 22-26 of the paper.*

## Exercise 2.2 International evidence - Economic growth

### a) One more plot

Again, we want to check if the high responsiveness of top incomes is due to a change in economic productivity and GDP and hence due to a high supply-side elasticity $e_1$. To do this, we first prepare our data to be able to create a plot. In order to do this we are going to use four different functions that are provided by the *dplyr* package:

* `group_by()` takes a data frame and returns a data frame grouped by a certain variable. This command is used with the syntax `group_by(table.name, variable.name)`.
* `do()` gets passed a grouped data frame `data` and performs a computation on each group. It is a general purpose complement to the specialized manipulation functions such as `filter()`. This command uses the syntax `do(grouped.data.name, function.name(.))`. `.` is used as a placeholder for the grouped data. `do()` always returns a data frame.
* `first()` and `last()` are specialized versions of the command `nth()` and can be utilized to return the first and last element, respectively, of a column.

The next example shows you how we can use these functions to create the data frame `Int_growth.data` which, for each country, contains the variable `dmtr_perc` which depicts change in top MTR over the time span of our data in percentage points and `gdp_growth` which depicts average annual real GDP growth for the same period in percent.  
Of course, as there are a lot of new functions in this code chunk simultaneously, it might be a little hard to understand how the single commands work. But this example is primarily designed to give you an impression of what is possible to accomplish with the *dplyr* package. Just try to comprehend it as good as you can, using the descriptions given above.

```{r "2_2_a_example_1"}
# Again, we upload our data:
Int.data = read.dta("intdata.dta")

# Then, we create a new data frame that contains the variables we need:
Int_growth.data = do(group_by(Int.data, country),
                     data.frame(dmtr_perc = 100 * (last(.$mtr) - first(.$mtr)),
                                gdp_growth = 100 * ((last(.$gdpcap) /
                                          first(.$gdpcap))^(1 / 50) - 1)))
```

Use the *data*-button to take a look at `Int_growth.data`. You can see that it has three columns and 18 rows, containing the overall change in top MTR and average annual GDP growth for each country.

Now, let's see if you still remember the things that we've learned in *Exercise 1.1*: Create the ggplot object `p1` that uses the new created data and depicts average GDP growth `gdp_growth` in dependency of overall top MTR change `dmtr_perc` as blue points that have the size `3.5`. Note: points can be depicted with `geom_point` instead of `geom_line`. Don't forget to add `size` to its arguments.

```{r "2_2_a"}
p1 = ggplot(Int_growth.data) + geom_point(aes(dmtr_perc, gdp_growth),
                                          colour = "blue", size = 3.5)
```

Before we plot `p1` we are going to add expressive labels to our plot. In addition, we are going to use the theme that is used by the weekly newspaper "The Economist" for their plots. This function is provided by the package *ggthemes*. (Again, this example is intended rather as a stimulus than for you to completely internalize.)

```{r "2_2_a_example_2"}
# First, we add a title, and a label for both the x- and the y-axis:
p1 = p1 + ggtitle("Growth and change in top marginal tax rate (1960 - 2010)") +
          xlab("Change in top marginal tax rate (points)") +
          ylab("GDP per capita real annual growth (percent)")

# Add a label for each country at the position where the points are.
# 'Vjust = 1' shifts the labels a little downward so that they are directly
# below the points.
p1 = p1 + geom_text(aes(x = dmtr_perc, y = gdp_growth, label = country),
                    size = 4, vjust = 1)

# Change the range of the x-axis to get all labels into the plot:
p1 = p1 + coord_cartesian(xlim = c(-56,20))

# Load the package 'ggthemes' from the library and add the Economist theme to
# the plot:
library(ggthemes)
p1 = p1 + theme_economist()

# Finally, show the plot:
p1
```

If we look at the plot, there is no significant correlation visible between cuts in top tax rates and economic growth. (This also holds true for the sub periods, as Piketty et al. show in the Appendix of their paper.) If a substantial part of the high responsiveness of top incomes to top tax rates would be due to supply-side responses, decreases in top tax rates should also lead to higher GDP growth. However, this is not the case in our data. This indicates a high compensation-bargaining elasticity $e_3$ and a low supply-side elasticity $e_1$. This is especially true if we assume that the influence of tax avoidance responses and therefore $e_2$ is small, as we have found in our US evidence.

### b) One more regression

One last time, we want to test our conclusions with regression analysis. We are going to use the following regression over the whole time span:

$$log(real~GDP~per~capita)~=~\alpha~+~\beta~\cdot ~log(1~-~top~MTR)~+~c~\cdot ~time~+~b~\cdot ~country~+$$
$$~~~~~~~~~~~~~~~d~\cdot ~time\cdot initial~GDP~per~capita~+~\epsilon$$

As you can see, not only do we implement a time trend and country fixed effects, we also include the interaction of initial GDP
per capita with a time trend. This incorporates the catch-up effect initial GDP might have on GDP growth for poor countries.

info("Growth Theory") # Run this line (Strg-Enter) to show info

The next example demonstrates how to use the command `mutate()` from the *dplyr* package to get the logarithm of GDP per capita for the first year for each country. First, we group `Int.data` by the variable `country` using the `group_by()` function. Then, we pass this data frame to `mutate()` as a first argument and determine in the second argument what should be done with each group: We want to compute the logarithm of the first entry for `gdpcap` for each country, which we manage by using the function `first()`, and assign it to `ln_gdp_start`. The `mutate()` function creates a new data frame, containing the old data and the additional column `ln_gdp_start` which we save as `Int.data`. Last, we calculate the mean of the logarithm of the GDP in 1960 for the 18 different countries and assign it to `ln_gdp_start_avg`.

```{r "2_2_b_example_1"}
# Use mutate to add the new column 'ln_gdp_start' to the data frame
# 'Int.data':
Int.data = mutate(group_by(Int.data, country),
                  ln_gdp_start = log(first(gdpcap)))

# Compute the average of initial GDP:
ln_gdp_start_avg = mean(Int.data$ln_gdp_start)

# show the variable:
ln_gdp_start_avg
```

Now it's your turn, again. Use `mutate()` to add a column to Int.data with the name `gdp_start_year` which depicts the product of `(ln_gdp_start - ln_gdp_start_avg)` and `(year - 1960)`. Note that you have to group the data by country, again.

```{r "2_2_b"}
Int.data = mutate(group_by(Int.data, country), 
                  gdp_start_year = (ln_gdp_start - ln_gdp_start_avg) *
                                   (year - 1960))
```

The purpose of the variable `gdp_start_year` is to test for the influence initial GDP has on GDP growth. It is negative if initial GDP is below average and vice versa. (Again, the use of the *Data Explorer* can be useful.)

Now we can do the regression that we looked at above. We use the same robust standard errors as we did in *Exercise 2.1*. Besides implementing a couple of arguments of `showreg()` to make the result better looking, this time we are going to use the html-output of `showreg()`. All we have to do is set the argument `output` to "html".

```{r "2_2_b_example_2", results = 'asis'}
# First, we do the regression, also using the new variable we created:
Int.reg2 = lm(log(gdpcap) ~ log(1 - mtr) + year + country + gdp_start_year,
              data = Int.data)

# Then, we show that regression using 'showreg()'. Again, we set
# 'robust = TRUE' and 'robust.type = "HC1"'. We omit all coefficients that
# include the word 'country'. We also add a title, a caption and custom
# coefficient names. Then we set 'output = "html"' in order to receive
# html-output:
showreg(list(Int.reg2), custom.model.names = c("1960-2010"), digits = 3,
        robust = TRUE, robust.type = "HC1", omit.coef = "country",
        title = "Effects of top MTR on real GDP per capita", caption =
         "Including a time trend, country fixed effects and a GDP time trend", 
        custom.coef.names =
         c(NA, "(1 - r)", "time trend", rep(NA, 17), "time x initial GDP"),
        output="html")
```

We can see that the effect of top net-of-tax rates $\beta$ is slightly negative, but it's not significant. That is why, in their paper, Piketty et al. "conservatively conclude that low top tax rates do not have any detectable positive impact on GDP per capita".  
At this point, we can state that it seems unlikely that the major part of the overall elasticity $e$ of top income shares to top net-of-tax rates is made up by the supply-side elasticity $e_1$. This leads Piketty et al. to the statement that our "macro-level analysis appears to be more consistent with our nonconventional bargaining model than with the standard model used in tax analysis".

While reverse causality still remains a possibility, we can find in our international data that in all countries that faced a large top marginal tax rate cut and a surge in top 1 percent income share, the increases in top income tend to follow the tax rate cuts.

The fact that we looked at various different countries diminishes the probability that we are underestimating the supply-side elasticity $e_1$ due to external effects that are independent from top tax rates and influence GDP.  
However, we still face the possibility that deviations of GDP growth from its trend not caused by top tax rates are correlated with the evolution of top tax rates. For example, countries could tend to cut top tax rates when they expect GDP growth to slow down. This, again, would lead to an underestimation of $e_1$. This is tackled by Piketty et al. by also looking at micro evidence where this problem is not an issue. (Find out more at the bottom of this page.)

Note: Piketty et al. also use this type of regression to get a simple estimate of the different elasticities which will also influence our calculations of the optimal marginal top tax rate $r^*$. To find out how this can be done, take a look at the *info* section below.

info("Estimations of elasticities") # Run this line (Strg-Enter) to show info

*In their paper, Piketty et al. go on to analyse microeconomic evidence from both the US and OECD countries. They rule out some problems and counter arguments and consolidate the findings that we had. We will not further devote ourselves to the analysis of that data. However, you can find a short summary of their analysis in the info-box below.*

info("Microeconomic evidence") # Run this line (Strg-Enter) to show info

After we have analysed empirical evidence, in the next exercise we are going to take a look at an economic model with which we are going to try to describe our findings. This will help us to derive possible optimal top tax rates and policy implications.

*This partial exercise is based on pages 21f. and 26-28. There you can also find further regressions Piketty et al. perform (Including a bootstrapping method which they deploy as a robustness check on their results). The results and implications stay the same.*

## Exercise 3.1 Theory - Studying a model

*In this exercise we are going to analyse a model that includes the three elasticities we have already talked about. This exercise is not mandatory and you can skip it if you don't feel like reading it through. Just go to Exercise 3.2 where, at the beginning,  you can find a short summary of the most important findings of the model that is developed on this page.*  
*But it's still recommended to work through this theoretical exercise at some point because it gives you more profound economic insights into the topic.*

As promised in the beginning, now we take a deeper dive into the theoretical model Piketty et al. develop in their paper. While they consider a single model for each of the three scenarios (supply-side, tax-avoidance, compensation-bargaining) and combine them in a final formula for optimal top tax rate $r^*$, we are going to develop a model that combines the three income responses and will lead to the same results.  
Further derivations and information are given in several *info*-sections. 

We denote by $z$ taxable earnings and by $T(z)$ the non-linear tax schedule. Our top marginal tax rate above a given threshold $\bar{z}$ is still $r$.
The government maximizes the social welfare function $W=\int G(u_i)~dv(i)$, where $G()$ is increasing concave, $u_i$ is the utility of individual $i$ and $dv(i)$ is the density mass of people of individuals of type $i$. We assume that the average social marginal welfare weight for top bracket income earners is zero. This means that the government sets top MTR $r$ to maximize tax revenues among top incomes.

info("Welfare weight zero") # Run this line (Strg-Enter) to show info

### a) Deriving elasticities

Individuals can put effort $h_i(y)$ to generate real income $y$. (This emulates the standard supply-side model as in Saez (2001).)  
To describe bargaining compensation effects, individual $i$ receives a fraction $\eta$ of his real product $y$ and can put effort $k_i(\eta)$ into increasing compensation. This leads to income $\eta y$ and to bargained earnings $b=(\eta-1)y$.  
We also include a simple model that captures tax avoidance: We consider an environment where top earners can shelter a part $x$ of their real income $\eta y$ so that taxable income is $z=\eta y-x$. $z$ is taxed at marginal tax rate $r$ while sheltered income is taxed at $t$ lower then $r$. Sheltering an amount of income $x$ causes costs $d_i(x)$ for the individual $i$.  
(Note: All three effort functions $h_i(y)$, $k_i(\eta)$ and $d_i(x)$ are $\geq 0$, increasing and convex in their respective variable and normalized so that $h_i'(0)=k_i'(0)=d_i'(0)=0$.)

Adding all this together leads to a utility function for individual $i$:

$$u_i(c,y,x,\eta)=c-h_i(y)-d_i(x)-k_i(\eta),$$

where $c=\eta y-rz-tx+R$ is disposable after tax income and $R=r\bar{z}-T(\bar{z})$ denotes the virtual income coming out of the non-linear tax schedule.

If we differentiate the function $u_i(c,y,x,\eta)$ with respect to the variables that can be influenced by the individual we get the following three first order conditions:

* $h_i'(y)=\eta(1-r),$  
describing the optimal real income effort choice $h_i'(y)$ in dependency of top marginal tax rate $r$ and share $\eta$,

* $k_i'(\eta)=y(1-r),$  
describing the optimal bargaining effort $k_i'(\eta)$ in dependency of top MTR $r$ and real income $y$ and

* $d_i'(x)=r-t,$  
describing the optimal income sheltering effort $d_i'(x)$ in dependency of the margin between top MTR $r$ and sheltered income tax $t$.

info("Derivation 1") # Run this line (Strg-Enter) to show info

Let's do a quiz to internalize these first findings.

```{r "3_1_a"}
# Question 1: How do the three different efforts react to an increase in r
# (ceteris paribus)?
# Assign each of the three variables which depict the three different efforts
# to the values "+" if you think effort will also increase, "-" if you think
# effort will decrease and "=" if you think effort will stay the same:
# h = "???"
# k = "???" 
# d = "???"
# Assign "+", "-" or "=" to the three effort variables and remove the comment
#
# Question 2: What happens to sheltered income x if we set r = t?
# a) x = 0
# b) x = y
# c) Can't say
# answer = "???" # Assign "a", "b" or "c" to 'answer' and remove the comment

h = "-"
k = "-"
d = "+"
answer = "a"
```

We can now also express the three elasticities that we used throughout this problem set so far in formulas:

$$e_1=\dfrac{\dfrac{dy}{y}}{\dfrac{d(1-r)}{1-r}}$$

is the **supply-side elasticity**, also called first elasticity or real elasticity. It describes by how much real economic productivity changes if the net-of-tax rate changes. Piketty et al. call this the only real limiting factor for optimal top tax rates as both tax avoidance and compensation bargaining is harmful.

$$e_2=s_2\cdot e=\dfrac{\dfrac{dx}{z}}{\dfrac{d(r-t)}{1-r}}$$

describes the **tax-avoidance elasticity**. It depicts by how much sheltered income changes in relation to reported taxable income if the margin between top MTR and tax on sheltered income changes in relation to the top net-of-tax rate. Piketty et al. define tax avoidance as "changes in reported income due to changes in the form of compensation but not in the total level of compensation". Tax avoidance depends vitally on the tax system and its opportunities for avoidance. In our model, $e_2$ makes up the fraction $s_2$ of $e$.

info("Tax avoidance") # Run this line (Strg-Enter) to show info

$$e_3=s_3\cdot e=\dfrac{\dfrac{db}{z}}{\dfrac{d(1-r)}{1-r}}$$

is the **compensation-bargaining elasticity**, or just bargaining elasticity. It describes by how much bargained earnings change in relation to reported taxable earnings if net-of-tax rate changes. Bargained earnings describe the difference between pay and marginal economic product. In our model, $e_3$ can be calculated as $e$ times the fraction $s_3$.

info("Compensation bargaining") # Run this line (Strg-Enter) to show info

info("Derivation 2") # Run this line (Strg-Enter) to show info

These three elasticity components combine to the overall elasticity $e$ in the following form:

$$e=\dfrac{y}{z}e_1+e_2+e_3=\dfrac{\dfrac{dz}{z}}{\dfrac{d(1-r)}{1-r}}.$$

Again, we can see in the formula what we already have discussed earlier: The overall elasticity $e$ describes by how much taxable income increases if the top net-of-tax rate increases.

info("Derivation 3") # Run this line (Strg-Enter) to show info

### b) Deriving the optimal top tax rate

Now, we want to take a look at the tax earnings of the government and see how we can develop an optimal top marginal tax rate from our findings.

The government aims to maximize taxes collected from taxpayers in the top bracket which are, in our model, described by the function 

$$T=r(z-\bar{z})+tx-N\cdot E(b).$$

$E(b)$ depicts the average bargained earnings in the economy. $N$ describes the size of the population. As we assume that the government adjusts the demogrant $-T(0)$ to fully offset $E(b)$, we have to subtract $E(b)$ from taxes collected from top bracket tax payers. (Note that this is a strong assumption. You can see a little discussion on this topic in the *info*-section below.)

info("Offset of bargaining effects") # Run this line (Strg-Enter) to show info

If we differentiate tax collected from taxpayers in the top bracket $T$ with respect to top MTR $r$ and apply the findings we gathered on elasticities above, the **optimal top marginal tax rate** can then be calculated as:

$$r^*=\dfrac{1+t\cdot a\cdot e_2+a\cdot e_3}{1+a\cdot e},$$

where $a$ depicts the Pareto parameter of the top tail of the distribution $z/(z-\bar{z})>1$. (Note that it is not trivial to know $a$, $t$, $e$, $e_2$ and $e_3$. This is why we have looked at extensive empirical evidence to be able to make estimations of optimal tax rates using this formula.)

info("Derivation 4") # Run this line (Strg-Enter) to show info

With the derivation of the optimal top tax rate $r^*$ we have reached the main proposition of Piketty et al.'s model. We want to take this opportunity to do another short quiz to analyse how changes in the different variables have an impact on this optimal top tax rate.

```{r "3_1_b"}
# Question 1: If we experience an increase in t, how does that influence our
# optimal top tax rate r* if we assume that e2 > 0?
# a) r* increases, too
# b) r* decreases
# c) r* stays the same
# answer1 = "???" # Assign "a", "b" or "c" to 'answer1' and remove the comment
#
# Question 2: How does an increase in e1 influence r* (ceteris paribus)?
# a) r* increases, too
# b) r* decreases
# c) r* stays the same
# answer2 = "???" # Assign "a", "b" or "c" to 'answer2' and remove the comment
#
# Question 3: How does an increase in the bargaining elasticity e3 (e.g. due
# to more bargaining possibilities) influence r* (ceteris paribus)?
# a) r* increases, too
# b) r* decreases
# c) r* stays the same
# answer3 = "???" # Assign "a", "b" or "c" to 'answer3' and remove the comment

answer1 = "a"
answer2 = "b"
answer3 = "a"
```

Great, now we have worked through the model that we will use to explain the observations we can make in our data. Before you move on, you can click the *info*-sections below if you want to find out how we can prove that in the optimal case $t^*=r^*$ or if you are interested in what would happen in our model if we had a positive social welfare weight on consumption of top earners.

info("Optimal tax policy") # Run this line (Strg-Enter) to show info

info("positive social welfare weights") # Run this line (Strg-Enter) to show info

*The derivations and interpretations in this partial exercise follow pages 5-16 of the paper.*

## Exercise 3.2 Theory - Developing a function

In this exercise, we want to implement a short function that can calculate the optimal top marginal tax rate $r^*$ that we have derived in *Exercise 3.1*:

$$r^*=\dfrac{1+t\cdot a\cdot e_2+a\cdot e_3}{1+a\cdot e}$$

info("If you have skipped Exercise 3.1") # Run this line (Strg-Enter) to show info

We want to start with an example. You probably know the pq-formula:

$$x_{1,2}=-\dfrac{p}{2}\pm\sqrt{\dfrac{p}{2}-q},$$

which is used to calculate the two zeros of a monic quadratic equation of the form

$$x^2+p\cdot x+q=0.$$

We can translate the calculations for the two solutions of the pq-formula into the following code:

```
-p/2 + sqrt((p/2)^2 - q)
-p/2 - sqrt((p/2)^2 - q)
```

We use the function `sqrt()` to compute the square root and the syntax `x^y` to get `x` to the power of `y`.

In the next code chunk you can see how the pq-formula is implemented as a function that returns the two solutions using the R-computations we just introduced. Run the code to upload the function into our working environment.

```{r "3_2_example_1"}
pq.formula = function(p, q){
  return(c(-p/2 + sqrt((p/2)^2 - q), -p/2 - sqrt((p/2)^2 - q)))
}
```

You can see that the function gets the two variables p and q passed in the header of the function. Then, it computes the two zeros and concatenates them using the function `c()`. The result, an array with two values, is returned with the command `return()`.

Let's see how we can use that function. Suppose, we have the following quadratic equation:

$$x^2+2x-3=0$$

Now we can use `pq.formula` with the values $p=2$ and $q=-3$ to compute the two zeros of this equation:

```{r "3_2_example_2"}
pq.formula(2, -3)
```

The function returns the two zeros $x_1=1$ and $x_2=-3$. You can see that the function uses the variables we pass it in the same order as they are defined in the header of the function.  
Throughout this problem set we have already used a couple of different functions, like `read.table()`, `log()` or `filter()`, but now we also know how to program our own functions that we can then use in the same way.

info("What about no zeros?") # Run this line (Strg-Enter) to show info

Let's utilize this to implement a function for our optimal top marginal tax rate $r^*$ step by step.

Again, take a look at the formula that we have derived:

$$r^*=\dfrac{1+t\cdot a\cdot e_2+a\cdot e_3}{1+a\cdot e}$$

As you can see we need the following variables to be able to obtain a solution: $e$, $e_2$, $e_3$, $t$ and $a$. 

Now, implement the formula for $r^*$ as code, using the variables `e`, `e2`, `e3`, `t` and `a` (You don't have to write a function, yet).

```{r "3_2_1"}
# First, we set all the variables to default values. We are going to put in
# more meaningful numbers later.
e = 0.3
e2 = 0.1
e3 = 0.1
t = 0.2
a = 1.2

# Then, you can type in your formula here:

(1+t*a*e2+a*e3)/(1+a*e)
```

Now, we write a function named `top.tax` that gets passed the variables we need in the following order: $e$, $e_2$, $e_3$, $t$, $a$. Then, the function returns the optimal top tax rate, using the computation that we wrote in the last code chunk.

```{r "3_2_example_3"}
top.tax = function(e,e2,e3,t,a){
  return((1+t*a*e2+a*e3)/(1+a*e))
}
```

Now it's time to test our function. Let us assume that the variables have the following values: $e = 0.35$, $e_2=0.1$, $e_3=0.05$, $t=0.25$ and $a=1.8$. Call the function `top.tax` with these values. Make sure to use the values in the right order or, alternatively, assign the variables manually: `(e2 = 0.1, e = 0.35, ...)`.

```{r "3_2_2"}
top.tax(0.35, 0.1, 0.05, 0.25, 1.8)
```

As you can see, the values we used for the different elasticities, taxes and parameters lead to an optimal top tax rate of about $70\%$.

But of course, these numbers are only fictional. In the next exercise we are going to use numbers that should be closer to reality.

## Exercise 4 Four Scenarios

*You must have finished Exercise 3.2 to be able to work on this exercise.*

After gathering implications from economic evidence and developing a theoretical framework, we finally want to apply our findings and derive implications for tax policy. For this purpose we look at four possible scenarios that Piketty et al. consider that explain the surges in top income shares and the coinciding cuts in top marginal tax rates that we could observe in our data. In addition, we use the function we have developed in *Exercise 3.2* to calculate possible corresponding optimal top tax rates that maximize tax revenue from top bracket earners.

### a) Skill-Biased-Technological-Change Scenario

In this scenario, the increase in top income shares over the last recent decades is explained by the fact that technological progress has been skill-biased and has favoured top earners with high qualifications. This means that highly talented individuals were able to increase their economic productivity while the rest of the workers' productivity more or less stagnated. This effect could coincide with cuts in top marginal tax rates and lead to an overestimation of top income elasticity $e$.

Piketty et al. come to the conclusion that "this scenario cannot explain why only some OECD countries have experienced a surge in top income shares and why that surge has been highly correlated with the drop in top marginal tax rates" as all OECD countries have experienced similar technological change. They also point out that this scenario cannot explain the strong correlation between CEO pay and top net-of-tax rates in their microeconomic evidence.

### b) Supply-Side Scenario

This scenario describes a situation where decreasing top tax rates lead to higher top income shares because top earners raise their work effort. This corresponds to the classic supply-side story that was proposed by Lindsey (1987) and Feldstein (1995).

In their paper, Piketty et al. consider an overall elasticity $e=0.5$, a figure that is consistent with the estimates that we were able to produce with our statistical analysis of US and international evidence.  
In the pure supply-side scenario, there is no tax avoidance and no compensation bargaining. This leads to $e=e_1=0.5$ and $e_2=e_3=0$. As Pareto coefficient $a$ we are going to use the one that Piketty et al. identify for the United States: $a=1.5$. And for alternative tax on sheltered income $t$ we are going to use $t=0.2$. (A value that is hard to estimate, as Piketty et al. admit, but in our case is perhaps reasonable. Note that in this case $t$ can be chosen randomly, because it is multiplied with $e_2\cdot a=0$.)

Now, call the function `top.tax(e,e2,e3,t,a)` with the corresponding values to find out which optimal top tax rate our model suggests for this scenario. Assign your result to the variable `top_tax_supply` and show it.

```{r "4_b"}
# assign 'top_tax_supply'

# show the variable

top_tax_supply = top.tax(0.5, 0, 0, 0.2, 1.5)
top_tax_supply
```

As you can see, in our model the values that we chose for the supply-side scenario lead to an optimal top tax rate $r^*=57\%$.

### c) Tax-Avoidance Scenario

This scenario posits that the high overall top income elasticity $e$ is due to a large avoidance elasticity $e_2$. That means that increasing tax rates lead top earners to exploit loopholes which allow them to report less ordinary income while not necessarily reducing their economic product.

This translates into a high tax-avoidance elasticity $e_2$. Piketty et al. consider a scenario with the following values: overall elasticity $e=0.5$, tax-avoidance elasticity $e_2=0.3$, compensation-bargaining elasticity $e_3=0$, Pareto coefficient $a=1.5$ and tax on sheltered income $t=0.2$.  
Again, call the function `top.tax(e,e2,e3,t,a)` with these values and assign the result to the variable `top_tax_avoidance`.

```{r "4_c"}
# assign 'top_tax_avoidance'

# show the variable

top_tax_avoidance = top.tax(0.5, 0.3, 0, 0.2, 1.5)
top_tax_avoidance
```

We can observe that, now, we obtain a revenue-maximizing top tax rate of $r^*=62\%$ which is higher than in the standard supply-side scenario. This is due to the fiscal externality that is created by the fact that some of the income that is shifted away from ordinary income can still be taxed as sheltered income with the tax rate $t$.

Note: In their paper, Piketty et al. show that, if the government is able to broaden the base and increase tax enforcement to reduce tax-avoidance elasticity $e_2$ to $0.1$ (while keeping $e_1=0.2$ constant), in our model we obtain an optimal top tax rate $r^*$ of $71\%$. This makes clear that, in the tax-avoidance scenario, the government first has to close loopholes before being able to further increase top tax rates.

### d) Compensation-Bargaining Scenario

In this scenario, lower top tax rates lead to higher top income shares because they motivate top earners to bargain more aggressively for higher compensation. In their paper, Piketty et al. come to the conclusion that this scenario is most consistent with the evidence that we also looked at in this problem set and suggest the following estimates: $e=0.5$, $e_2=0$ and $e_3=0.3$. The Pareto coefficient $a=1.5$ and tax on sheltered income $t=0.2$ again stay the same. Piketty et al. call these estimates their "preferred estimates" while also mentioning that "these estimates are not sharply identified but they illustrate the critical importance of the decomposition of the overall elasticity into three elasticities."  

One last time, translate these estimates into a top marginal tax rate $r^*$ utilizing our function `top.tax()`. Assign the result to the variable `top_tax_bargaining` and show it.

```{r "4_d"}
# assign 'top_tax_bargaining'

# show the variable

top_tax_bargaining = top.tax(0.5, 0, 0.3, 0.2, 1.5)
top_tax_bargaining
```

You can observe that, in our model, this scenario leads to the by far highest optimal top tax rate $r^*$. This is due to the fact that we assumed that compensation bargaining is completely harmful and hence is tried to be avoided by the government.

In this exercise we could see what top tax rates the different scenarios and their respective composition of top income elasticity $e$ lead to in the model of Piketty et al. In the next and also last exercise we are going to further discuss these findings.

*This scenario analysis is based on pages 4 and 37-39.*

## Exercise 5 Conclusion

### a) Scenario Summary

The following table sums up the results from our calculations from *Exercise 4*:

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:9px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:9px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-s6z2{text-align:center}
.tg .tg-asmn{font-weight:bold;font-size:18px;text-align:center}
.tg .tg-3dpa{font-weight:bold;background-color:#ecf4ff;text-align:center}
.tg .tg-3lkx{font-weight:bold;font-size:16px;background-color:#bbdaff;text-align:center}
.tg .tg-hgcj{font-weight:bold;text-align:center}
</style>
<table class="tg">
  <tr>
    <td class="tg-3lkx" rowspan="2">Supply-Side Scenario</td>
    <td class="tg-3lkx" colspan="2">Tax-Avoidance Scenario</td>
    <td class="tg-3lkx" rowspan="2">Compensation-Bargaining Scenario</td>
  </tr>
  <tr>
    <td class="tg-3dpa">narrow tax base</td>
    <td class="tg-3dpa">broad tax base</td>
  </tr>
  <tr>
    <td class="tg-s6z2">e<sub>1</sub>=0.5<br>e<sub>2</sub>=0.0<br>e<sub>3</sub>=0.0</td>
    <td class="tg-s6z2">e<sub>1</sub>=0.2<br>e<sub>2</sub>=0.3<br>e<sub>3</sub>=0.0</td>
    <td class="tg-s6z2">e<sub>1</sub>=0.2<br>e<sub>2</sub>=0.1<br>e<sub>3</sub>=0.0</td>
    <td class="tg-s6z2">e<sub>1</sub>=0.2<br>e<sub>2</sub>=0.0<br>e<sub>3</sub>=0.3</td>
  </tr>
  <tr>
    <td class="tg-hgcj">r*=57%</td>
    <td class="tg-hgcj">r*=62%</td>
    <td class="tg-hgcj">r*=71%</td>
    <td class="tg-hgcj">r*=83%</td>
  </tr>
</table>
This table depicts the optimal top tax rates $r^*$ that result from the application of the model of Piketty et al.  
Remember that for all estimations in this table we used $t=0.2$ and $a=1.5$.

We can understand from this table that it is very important for the government to know the composition of the top income elasticity $e$ in order to be able to set the optimal top marginal tax rate $r^*$ that maximizes top tax returns. Using the Pareto coefficient $a=1.5$ and the tax on sheltered income $t=0.2$ that Piketty et al. identify for the US, the results vary from $57\%$ under the supply-side scenario to up to $83\%$ under the compensation bargaining scenario. Note that top MTR is recently slightly below $40\%$ in the US according to the  Internal Revenue Service (2013).  
The table also shows the importance of tax base broadening under the tax-avoidance scenario that was mentioned in *Exercise 4*.

If we follow the implications from our evidence and the conclusions that Piketty et al. draw from them, the compensation-bargaining scenario is the most likely one to explain the strong correlation between top net-of-tax rates and top income shares. (Remember that US evidence suggested a small tax avoidance elasticity $e_2$ and both US and international evidence indicated that supply-side elasticity $e_1$ is not the main driving factor of income responses. These results are also consistent with the findings Piketty et al. derive from their microeconomic evidence that are summarized at the end of *Exercise 2.2*.) This would mean that the surges of top income shares in some countries over the last decades can mainly be explained by top earners bargaining more aggressively for higher compensation.  
If we consider this scenario we obtain high top tax rates. For example, in the US we get an optimal top tax rate of about $83\%$ which is more than double the recent tax rate.  
(In the pure compensation-bargaining scenario, where bargaining elasticity $e_3=e$, we would in fact receive an optimal top tax rate $r^*=100\%$.)

### b) Further Outlook

Just as Piketty et al. do in their paper, we have focused on a revenue maximizing top tax rate and considered a marginal social welfare weight on top bracket earners $g$ of zero. But welfare weights may vary between societies. This may again depend on which of the three elasticities seems to be the most important: If we consider a pure supply-side scenario, "pay is fair by definition and hence a zero weight can only be justified by strong redistributive motives", as Piketty et al. state.  
And also in other scenarios it might not be trivial to assume only revenue maximizing motives.

The following code chunk is designed to show you how social welfare weight on top earners $g\in [0,1)$ can influence optimal top tax rate $r^*$ in the compensation bargaining scenario that we have considered. First, we implement the function `top.tax.g(e,e2,e3,t,a,g)` which is an extension of the function that we have developed in *Exercise 3.2* and follows the formula that Piketty et al. derive in their paper that also includes $g$ (See the last *info* box of *Exercise 3.1*). Then, we use the function `stat_function()` from the *ggplot* package to plot `top.tax.g(e,e2,e3,t,a,g)` in dependency of $g$ while using all the other values from our compensation-bargaining scenario ($e=0.5$, $e_2=0$, $e_3=0.3$, $a=1.5$ and $t=0.2$). (Again, this code serves mainly as an incitation - Just try to comprehend it and maybe test it for your own purposes.)

```{r "5_b_1"}
# First, we implement the function 'top.tax.g()':
top.tax.g = function(e,e2,e3,t,a,g){
  return((1-g+t*a*e2+a*e3)/(1-g+a*e))
}

# We use 'stat_function()' to plot r* for values of g between 0 and 1. Note
# that we have to first create a dummy data set. Again, we use some of the
# arguments of 'ggplot()' to make the plot better-looking:
p = ggplot(data.frame(x = c(0, 1)), aes(x)) + 
    stat_function(fun = function(x) top.tax.g(0.5,0,0.3,0.2,1.5,x), size = 1.5,
                  colour = "blue") + xlab("social welfare weight g") + 
    ylab("optimal top tax rate r*") + 
    ggtitle("The relation between g and r*
    in Piketty et al.'s bargaining scenario") +
    theme(plot.title = element_text(size = 14, face = "bold"))

# Finally, we show the plot:
p
```

You can see that, depending on the social welfare weight $g$, in the compensation-bargaining scenario with $e_3=0.3$ the optimal marginal top tax rate $r^*$ varies between $60\%$ for high welfare weights and $83\%$ for low welfare weights. This example serves to demonstrate that in order for a government to determine the optimal top tax rate $r^*$ it not only needs to know the decomposition of the income elasticity $e$ but also has to identify the welfare weight on top incomes $g$ that prevails in the society.

**Some space for testing**

At the end of this problem set, here is one last code chunk where you can play around a little bit with different values for the variables that we have discussed throughout the different exercises. Simply change the values the function `top.tax.g()` is called with and see what optimal top tax rate $r^*$ the model of Piketty et al. suggests. (Note that according to Piketty et al., the prevailing Pareto coefficient for many European countries is $a=2$.)

```{r "5_b_2"}
top.tax.g(e=0.5, e2=0, e3=0.3, t=0.2, a=2, g=0)
```

**Congratulations, you have successfully worked through this problem set!**  
We have studied a framework that describes top income responses to top marginal tax rates and derived optimal top tax rates for different scenarios. We also looked at macroeconomic evidence to comprehend which of these scenarios possibly describes real economic phenomenons. And, of course, we looked at various R solutions that help us tackling such problems.  
Hopefully, you have enjoyed this problem set and have gathered a lot of different skills that motivate you to approach other economic issues.

*For this last exercise, compare pages 38-40 of the paper.*

---

### References

**Academic Papers and Books**

* Bertrand, Marianne, & Sendhil Mullainathan. (2001). "Are CEOs Rewarded for Luck? The Ones without Principals Are". Quarterly Journal of Economics 116 (3), p. 901-32. DOI: 10.1162/00335530152466269

* Feldstein, Martin. (1995). "The Effect of Marginal Tax Rates on Taxable Income: A Panel Study of the 1986 Tax Reform Act". Journal of Political Economy 103 (3), p. 551-72.

* Hayashi, Fumio. (2000). "Econometrics". Princeton University Press. ISBN: 978-0-691-01018-2

* Internal Revenue Service (Department of the Treasury). (2013). "Your Federal
Income Tax". Publication 17, Catalog Number 10311G.

* Lewis-Beck, Michael S., Alan E. Bryman, and Tim F. Futing Liao. (2003). "The Sage encyclopedia of social science research methods". Sage Publications. ISBN: 978-0-761-92363-3

* Lindsey, Lawrence B. (1987). "Individual Taxpayer Response to Tax Cuts: 1982-1984: With Implications for the Revenue Maximizing Tax Rate". Journal of Public Economics 33 (2), p. 173-206. DOI: 10.1016/0047-2727(87)90073-9

* MacKinnon, James G., & Halbert White. (1985). "Some heteroskedasticity-consistent covariance matrix estimators with improved finite sample properties". Journal of Econometrics, 29(3), p. 305-325.

* Newey, Whitney, & Kenneth D. West. (1987). "A Simple, Positive Semi-definite, Heteroskedasticity and Autocorrelation Consistent Covariance Matrix"." Econometrica, 55, issue 3, p. 703-08.

* Piketty, Thomas, Emmanuel Saez, & Stefanie Stantcheva. (2014). "Optimal Taxation of Top Labor Incomes: A Tale of Three Elasticities". American Economic Journal: Economic Policy, 6(1), p. 230-71. DOI: 10.1257/pol.6.1.230

* Saez, Emmanuel. (2001). "Using Elasticities to Derive Optimal Income Tax Rates". Review of Economic Studies 68 (1), p. 205-29. DOI: 10.3386/w7628

* Slemrod, Joel, & Shlomo Yitzhaki. (2002). "Tax avoidance, evasion, and administration". Handbook of public economics, 3, p. 1423-1470. DOI: 10.1016/S1573-4420(02)80026-X

* Solow, Robert M. (1956). "A contribution to the theory of economic growth". The Quarterly Journal of Economics, 70 (1), p. 65-94. DOI: 10.2307/1884513

* Stiglitz, Joseph E. (1985). "The General Theory of Tax Avoidance". National Tax Journal, Volume XXXVIII, No. 3, September 1985, p. 325-338. DOI: 10.3386/w1868

* Wickham, Hadley. (2009). "ggplot2: Elegant Graphics for Data Analysis". Springer. ISBN: 978-0-387-98140-6

* Wilkinson, Leland. (2005). "The Grammar of Graphics". Springer. ISBN: 978-0-387-28695-2

**R and R packages**
  
* Arnold, Jeffrey B. (2014). ggthemes: Extra themes, scales and geoms for ggplot. R package version 1.7.0. http://CRAN.R-project.org/package=ggthemes

* Auguie, Baptiste. (2012). gridExtra: functions in Grid graphics. R package version 0.9.1. http://CRAN.R-project.org/package=gridExtra

* Gesmann, Markus, & Diego de Castillo. (2011). googleVis: Using the Google Visualisation API with R. The R Journal, 3(2):40-44, December 2011.

* Kranz, Sebastian. (2014). regtools: Tools for presenting regressions results. R package version 0.1.

* Kranz, Sebastian. (2014). RTutor: Creating R exercises with automatic assessment of student's solutions. R package version 0.5.5.

* R Core Team. (2014). foreign: Read Data Stored by Minitab, S, SAS, SPSS, Stata, Systat, Weka, dBase, .... R package version 0.8-61. http://CRAN.R-project.org/package=foreign

* R Core Team. (2014). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. http://www.R-project.org/
  
* Wickham, Hadley. (2009). ggplot2: Elegant graphics for data analysis. Springer New York.

* Wickham, Hadley, & Romain Francois. (2014). dplyr: A Grammar of Data Manipulation. R package version 0.3.0.2. http://CRAN.R-project.org/package=dplyr

* Zeileis, Achim. (2004). sandwich: Econometric Computing with HC and HAC Covariance Matrix Estimators. Journal of Statistical Software 11(10), 1-17. URL http://www.jstatsoft.org/v11/i10/.

**Websites**

* Vigen, Tyler. (2014). Spurious Correlations. http://tylervigen.com/.

### License

Author: Jonas Send  
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
